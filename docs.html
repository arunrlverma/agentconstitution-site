<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Documentation — Agent Constitution</title>
  <meta name="description" content="Developer documentation for Agent Constitution. Learn how to integrate the skill package, use the API, and configure your AI agent.">
  <meta name="theme-color" content="#0a0a0f">
  <link rel="canonical" href="https://agentconstitution.com/docs.html">
  
  <!-- Open Graph -->
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://agentconstitution.com/docs.html">
  <meta property="og:title" content="Documentation — Agent Constitution">
  <meta property="og:description" content="Developer documentation for Agent Constitution. Learn how to integrate the skill package, use the API, and configure your AI agent.">
  <meta property="og:image" content="https://agentconstitution.com/img/og-image.png">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Documentation — Agent Constitution">
  <meta name="twitter:description" content="Developer documentation for Agent Constitution. Learn how to integrate the skill package, use the API, and configure your AI agent.">
  
  <link rel="stylesheet" href="css/style.css?v=7">
  <link rel="icon" href="img/favicon.svg" type="image/svg+xml">
  <style>
    .docs-content { max-width: 800px; margin: 0 auto; padding: 2rem; }
    .docs-content h2 { margin-top: 3rem; color: var(--accent); }
    .docs-content h3 { margin-top: 2rem; }
    .docs-content pre { background: #1a1a2e; padding: 1.5rem; border-radius: 8px; overflow-x: auto; margin: 1rem 0; }
    .docs-content code { background: #1a1a2e; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.9em; }
    .docs-content pre code { padding: 0; background: none; }
    .docs-content table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
    .docs-content th, .docs-content td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #333; }
    .docs-content th { color: var(--accent); }
    .docs-content ul { margin: 1rem 0; padding-left: 1.5rem; }
    .docs-content li { margin: 0.5rem 0; }
    .docs-nav { background: #1a1a2e; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; }
    .docs-nav a { color: var(--accent); margin-right: 1.5rem; text-decoration: none; }
    .docs-nav a:hover { text-decoration: underline; }
    .note { background: rgba(0, 255, 136, 0.1); border-left: 3px solid var(--accent); padding: 1rem; margin: 1rem 0; border-radius: 0 8px 8px 0; }
    .warning { background: rgba(255, 200, 0, 0.1); border-left: 3px solid #ffc800; padding: 1rem; margin: 1rem 0; border-radius: 0 8px 8px 0; }
  </style>
</head>
<body>

<!-- ── Nav ──────────────────────────────────────────────── -->
<nav>
  <div class="container">
    <a href="/" class="nav-brand">
      <img src="img/icon.svg" alt="Agent Constitution">
      Agent Constitution
    </a>
    <div class="hamburger" onclick="this.classList.toggle('open');document.querySelector('.nav-links').classList.toggle('open')">
      <span></span><span></span><span></span>
    </div>
    <div class="nav-links">
      <a href="/#how-it-works">How It Works</a>
      <a href="/#rules">Rules</a>
      <a href="/#features">Features</a>
      <a href="/screenshots/gallery.html">Screenshots</a>
      <a href="/security.html">Security</a>
      <a href="/privacy.html">Privacy</a>
      <a href="/support.html">Support</a>
      <a href="/docs.html" class="active">Docs</a>
      <a href="https://github.com/arunrlverma/agent-constitution" target="_blank">GitHub</a>
      <a href="/#download" class="nav-cta">Download</a>
    </div>
  </div>
</nav>

<section class="hero" style="padding: 4rem 0 2rem;">
  <div class="container">
    <h1>Documentation</h1>
    <p>Everything you need to integrate Agent Constitution with your AI agent.</p>
  </div>
</section>

<div class="docs-content">
  <div class="docs-nav">
    <a href="#overview">Overview</a>
    <a href="#installation">Installation</a>
    <a href="#pairing">Pairing</a>
    <a href="#rules">Rules</a>
    <a href="#checking">Checking Rules</a>
    <a href="#vault">Vault</a>
    <a href="#health">Health Data</a>
    <a href="#drift">Drift Testing</a>
    <a href="#encryption">Encryption</a>
    <a href="#integrity">File Integrity</a>
    <a href="#api">API Reference</a>
  </div>

  <h2 id="overview">Overview</h2>
  
  <p>Agent Constitution lets you define behavioral rules for your AI agent in plain English. Before any restricted action, the agent checks your rules and waits for your approval via push notification.</p>
  
  <p>The system has three parts:</p>
  <ul>
    <li><strong>iOS App</strong> — where you define rules, approve actions, and view audit logs</li>
    <li><strong>Relay Server</strong> — a stateless message queue between your agent and phone</li>
    <li><strong>Agent Skill</strong> — bash scripts your agent uses to check rules and request approvals</li>
  </ul>

  <div class="note">
    <strong>Key principle:</strong> Rules are stored on your phone, not the server. The relay just passes messages — it can't see or modify your rules.
  </div>

  <h2 id="installation">Installation</h2>
  
  <p>Agent Constitution is distributed as a <strong>skill package</strong> for <a href="https://openclaw.ai" target="_blank">OpenClaw</a>.</p>

  <h3>Requirements</h3>
  <ul>
    <li><strong>OpenClaw</strong> — Install from <a href="https://openclaw.ai" target="_blank">openclaw.ai</a></li>
    <li><strong>Agent Constitution iOS App</strong> — Download from the App Store</li>
    <li><strong>jq</strong> — <code>brew install jq</code> (macOS) or <code>apt install jq</code> (Linux)</li>
    <li><strong>bash</strong> — Version 4+ recommended</li>
  </ul>

  <h3>Install the Skill</h3>
  <pre><code># Navigate to your OpenClaw workspace skills directory
cd $WORKSPACE/skills

# Clone the skill package
git clone https://github.com/arunrlverma/agent-constitution.git

# Run setup (patches AGENTS.md and HEARTBEAT.md)
bash agent-constitution/scripts/setup.sh</code></pre>

  <div class="note">
    <strong>$WORKSPACE</strong> is your OpenClaw workspace directory (e.g., <code>~/clawd</code>). The setup script will add constitution checking to your agent's boot sequence.
  </div>

  <h3>What Gets Installed</h3>
  <table>
    <tr><th>Component</th><th>Purpose</th></tr>
    <tr><td><code>SKILL.md</code></td><td>Instructions your agent reads at session start</td></tr>
    <tr><td><code>scripts/</code></td><td>Bash scripts for pairing, sync, approvals, vault, drift tests</td></tr>
    <tr><td><code>active-rules.json</code></td><td>Synced rules from your iPhone (created after pairing)</td></tr>
  </table>

  <h2 id="pairing">Pairing Your iPhone</h2>

  <p>After installing the app on your iPhone, tap "Pair Agent" to get a code like <code>CLAW-A1B2C3D4</code>.</p>

  <pre><code># Pair with your iPhone
bash skills/agent-constitution/scripts/pair.sh CLAW-A1B2C3D4</code></pre>

  <p>This creates <code>~/.secrets/relay4agents.env</code> with your credentials:</p>
  <pre><code>RELAY_URL=https://clawd-relay.fly.dev
CHANNEL_ID=your-channel-id
CHANNEL_TOKEN=your-secret-token</code></pre>

  <div class="note">
    <strong>Fast-Sync Mode:</strong> After pairing, the agent enters fast-sync mode (2-minute heartbeat) for 24 hours. This quickly syncs rules and health data during initial setup, then reverts to 30-minute intervals.
  </div>

  <h2 id="rules">Defining Rules</h2>

  <p>Rules are defined in the iOS app. Write them in plain English — describe what actions should require your approval.</p>

  <h3>Example Rules</h3>
  <ul>
    <li>"Ask before sending work emails"</li>
    <li>"Require approval for any purchase"</li>
    <li>"Never post to social media without confirmation"</li>
    <li>"Ask before running rm or delete commands"</li>
    <li>"Require approval to unlock doors"</li>
  </ul>

  <h3>Rule Format</h3>
  <p>Internally, rules use a structured format that helps agents match them consistently:</p>
  <pre><code>{
  "title": "Ask before sending work emails",
  "description": "TRIGGER: email, send, draft, compose. ACTION: Ask for approval first. CONSTRAINT: Do not send until approved.",
  "category": "communication",
  "enabled": true
}</code></pre>

  <p>You don't need to write this format — the app handles it. Just describe your rule in plain English.</p>

  <h2 id="checking">Checking Rules</h2>

  <p>Before performing any restricted action, your agent must check against active rules and wait for approval.</p>

  <h3>Using the Script</h3>
  <pre><code>bash skills/agent-constitution/scripts/check-constitution.sh \
  --rule "Ask before sending work emails" \
  --action "Send email to team@company.com about project update" \
  --reason "User asked me to send the weekly status update"</code></pre>

  <h3>Parameters</h3>
  <table>
    <tr><th>Parameter</th><th>Description</th></tr>
    <tr><td><code>--rule</code></td><td>The rule title (match exactly from active-rules.json)</td></tr>
    <tr><td><code>--action</code></td><td>What you want to do (be specific — user sees this)</td></tr>
    <tr><td><code>--reason</code></td><td>Why you need to do this</td></tr>
    <tr><td><code>--timeout</code></td><td>Seconds to wait (default: 60)</td></tr>
  </table>

  <h3>Exit Codes</h3>
  <table>
    <tr><th>Code</th><th>Meaning</th><th>Action</th></tr>
    <tr><td><code>0</code></td><td>Approved</td><td>Proceed with the action</td></tr>
    <tr><td><code>1</code></td><td>Denied or timeout</td><td>Do NOT proceed, inform user</td></tr>
  </table>

  <div class="warning">
    <strong>Important:</strong> Prior verbal permission does NOT override the constitution. Always check, even if the user says "you have my permission."
  </div>

  <h2 id="vault">Secure Vault</h2>

  <p>The vault lets your agent request sensitive data without it being typed in chat or stored in logs.</p>

  <h3>Vault Types</h3>
  <table>
    <tr><th>Type</th><th>Description</th><th>Fields</th></tr>
    <tr><td><code>identity</code></td><td>Personal info</td><td>Name, email, phone, address, DOB</td></tr>
    <tr><td><code>payment</code></td><td>Credit/debit cards</td><td>Card number, expiry, CVV, billing ZIP</td></tr>
    <tr><td><code>ssn</code></td><td>Social Security Number</td><td>9-digit SSN</td></tr>
    <tr><td><code>bank_account</code></td><td>Bank details</td><td>Routing number, account number</td></tr>
    <tr><td><code>otp</code></td><td>2FA/verification codes</td><td>One-time code (ephemeral)</td></tr>
    <tr><td><code>custom</code></td><td>Any key-value data</td><td>User-defined fields</td></tr>
  </table>

  <h3>Requesting Vault Data</h3>
  <pre><code># Request identity for shipping form
bash skills/agent-constitution/scripts/request-vault.sh identity "Fill shipping address"

# Request payment for checkout
bash skills/agent-constitution/scripts/request-vault.sh payment "Complete Amazon order"

# Request 2FA code
bash skills/agent-constitution/scripts/request-vault.sh otp "Enter verification code"</code></pre>

  <h3>How It Works</h3>
  <ol>
    <li>Agent calls <code>request-vault.sh</code> with type and reason</li>
    <li>User gets push notification on iPhone</li>
    <li>User selects data and approves with Face ID</li>
    <li>Data returns to agent, encrypted end-to-end</li>
    <li>Agent reads data, uses it immediately, then deletes</li>
    <li>60-second TTL — data auto-expires</li>
  </ol>

  <div class="warning">
    <strong>Critical:</strong> Never store vault data. Never print card numbers, SSNs, or account numbers in chat. Use the data immediately, then discard.
  </div>

  <h2 id="health">Health Data Sync</h2>

  <p>Optionally sync Apple Health metrics to your agent for health-aware assistance.</p>

  <h3>Available Metrics</h3>
  <ul>
    <li>Weight, body fat percentage</li>
    <li>Resting heart rate, HRV, walking heart rate</li>
    <li>Sleep hours (deep, REM, light breakdown)</li>
    <li>Steps, walking distance, flights climbed</li>
    <li>VO2 max, active calories, exercise minutes</li>
    <li>Workout history (type, duration, calories)</li>
  </ul>

  <h3>Syncing Health Data</h3>
  <pre><code># Pull new data from relay and regenerate dashboard
bash skills/agent-constitution/scripts/sync-health.sh

# Read latest metrics (no network)
bash skills/agent-constitution/scripts/fetch-health.sh latest

# Get 14-day history
bash skills/agent-constitution/scripts/fetch-health.sh history</code></pre>

  <h3>Data Storage</h3>
  <p>Health data is stored locally in your workspace:</p>
  <ul>
    <li><code>personal/health-history/YYYY-MM-DD.json</code> — Daily snapshots</li>
    <li><code>personal/health.md</code> — Auto-generated dashboard</li>
  </ul>

  <h2 id="drift">Drift Testing</h2>

  <p>AI agents can drift — forget rules, misinterpret them, or cave under pressure. Drift testing measures actual compliance.</p>

  <h3>How It Works</h3>
  <ol>
    <li>App generates realistic test prompts (probes)</li>
    <li>Probes are sent to your agent through the relay</li>
    <li>Agent responds naturally — doesn't know it's being tested</li>
    <li>Responses are evaluated for rule compliance</li>
    <li>Results show in the app's Compliance tab</li>
  </ol>

  <h3>Running Drift Tests</h3>
  <pre><code># Check for pending probes and run tests
bash skills/agent-constitution/scripts/run-drift-test.sh</code></pre>

  <h3>Safe by Design</h3>
  <p>All probes use inert targets — @example.com emails, 555 phone numbers, /tmp/ files. Even if the agent executes, nothing harmful happens.</p>

  <h2 id="encryption">End-to-End Encryption</h2>

  <p>All sensitive data is protected with AES-256-GCM encryption. The relay can't read your vault data, health metrics, or constitution checks.</p>

  <h3>How It Works</h3>
  <ul>
    <li><strong>Algorithm:</strong> AES-256-GCM (authenticated encryption)</li>
    <li><strong>Key derivation:</strong> HKDF-SHA256 from shared master secret</li>
    <li><strong>Directional keys:</strong> Separate keys for App→Agent and Agent→App</li>
    <li><strong>Nonces:</strong> Random 12-byte nonce per message</li>
    <li><strong>Auth tags:</strong> 16-byte GCM tag for integrity verification</li>
  </ul>

  <h3>Key Exchange</h3>
  <p>Encryption keys are established during pairing. The master key is stored in iOS Keychain and your agent's secrets file.</p>

  <h2 id="integrity">File Integrity Protection</h2>

  <p>Agent Constitution monitors critical files for tampering. If your agent modifies its own rules or scripts, the app detects it.</p>

  <h3>Protected Files</h3>
  <ul>
    <li><code>AGENTS.md</code> — Agent instructions</li>
    <li><code>active-rules.json</code> — Constitution rules</li>
    <li><code>check-constitution.sh</code> — Approval request script</li>
    <li><code>request-vault.sh</code> — Vault request script</li>
    <li>Encryption scripts and utilities</li>
  </ul>

  <h3>How It Works</h3>
  <ol>
    <li>On each heartbeat, file hashes are computed</li>
    <li>Manifest is signed with HMAC-SHA256</li>
    <li>App compares against known-good values</li>
    <li>If any file changed, tamper alert is shown</li>
  </ol>

  <h2 id="api">API Reference</h2>

  <p>All communication goes through the relay server via standard HTTP.</p>

  <h3>Base URL</h3>
  <pre><code>https://clawd-relay.fly.dev</code></pre>

  <h3>Authentication</h3>
  <pre><code>Authorization: Bearer YOUR_CHANNEL_TOKEN</code></pre>

  <h3>Push Message</h3>
  <pre><code>POST /channel/{channelId}/push?role=gateway
Content-Type: application/json

{
  "type": "constitution_check",
  "requestId": "unique-id",
  "ruleTitle": "Ask before sending work emails",
  "actionDescription": "Send email to team@company.com",
  "reason": "User requested weekly update"
}</code></pre>

  <h3>Pull Messages</h3>
  <pre><code>GET /channel/{channelId}/pull?role=gateway&wait=30</code></pre>
  <p>Long-polls for up to 30 seconds. Returns messages or empty array.</p>

  <h3>Message Types</h3>
  <table>
    <tr><th>Type</th><th>Direction</th><th>Description</th></tr>
    <tr><td><code>constitution_check</code></td><td>Agent → App</td><td>Request approval</td></tr>
    <tr><td><code>constitution_response</code></td><td>App → Agent</td><td>Approval decision</td></tr>
    <tr><td><code>vault_request</code></td><td>Agent → App</td><td>Request sensitive data</td></tr>
    <tr><td><code>vault_response</code></td><td>App → Agent</td><td>Encrypted vault data</td></tr>
    <tr><td><code>health_sync</code></td><td>App → Agent</td><td>HealthKit metrics</td></tr>
    <tr><td><code>constitution_rules_sync</code></td><td>App → Agent</td><td>Updated rules</td></tr>
    <tr><td><code>drift_probe_message</code></td><td>App → Agent</td><td>Drift test prompt</td></tr>
    <tr><td><code>drift_probe_response</code></td><td>Agent → App</td><td>Drift test result</td></tr>
  </table>

  <h3>Self-Hosting</h3>
  <p>The relay is open source. Deploy your own:</p>
  <pre><code>git clone https://github.com/arunrlverma/agent-constitution.git
cd agent-constitution/relay
npm install
npx tsx src/relay-node.ts</code></pre>

</div>

<!-- ── Footer ──────────────────────────────────────────── -->
<footer>
  <div class="container">
    <span class="footer-copy">© 2026 Arun Verma. All rights reserved.</span>
    <div class="footer-links">
      <a href="/privacy.html">Privacy Policy</a>
      <a href="/terms.html">Terms of Service</a>
      <a href="/support.html">Support</a>
      <a href="/security.html">Security</a>
      <a href="https://github.com/arunrlverma/agent-constitution" target="_blank">GitHub</a>
    </div>
  </div>
</footer>

<script>
document.querySelectorAll('.nav-links a').forEach(a => {
  a.addEventListener('click', () => {
    document.querySelector('.hamburger').classList.remove('open');
    document.querySelector('.nav-links').classList.remove('open');
  });
});
</script>
</body>
</html>
