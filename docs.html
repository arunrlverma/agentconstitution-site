<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Documentation — Agent Constitution</title>
  <meta name="description" content="Developer documentation for Agent Constitution. Learn how to integrate the skill package, use the API, and configure your AI agent.">
  <meta name="theme-color" content="#0a0a0f">
  <link rel="canonical" href="https://agentconstitution.com/docs.html">
  
  <!-- Open Graph -->
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://agentconstitution.com/docs.html">
  <meta property="og:title" content="Documentation — Agent Constitution">
  <meta property="og:description" content="Developer documentation for Agent Constitution. Learn how to integrate the skill package, use the API, and configure your AI agent.">
  <meta property="og:image" content="https://agentconstitution.com/img/og-image.png">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Documentation — Agent Constitution">
  <meta name="twitter:description" content="Developer documentation for Agent Constitution. Learn how to integrate the skill package, use the API, and configure your AI agent.">
  
  <link rel="stylesheet" href="css/style.css?v=6">
  <link rel="icon" href="img/favicon.svg" type="image/svg+xml">
  <style>
    .docs-content { max-width: 800px; margin: 0 auto; padding: 2rem; }
    .docs-content h2 { margin-top: 3rem; color: var(--accent); }
    .docs-content h3 { margin-top: 2rem; }
    .docs-content pre { background: #1a1a2e; padding: 1.5rem; border-radius: 8px; overflow-x: auto; margin: 1rem 0; }
    .docs-content code { background: #1a1a2e; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.9em; }
    .docs-content pre code { padding: 0; background: none; }
    .docs-content table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
    .docs-content th, .docs-content td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #333; }
    .docs-content th { color: var(--accent); }
    .docs-content ul { margin: 1rem 0; padding-left: 1.5rem; }
    .docs-content li { margin: 0.5rem 0; }
    .docs-nav { background: #1a1a2e; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; }
    .docs-nav a { color: var(--accent); margin-right: 1.5rem; text-decoration: none; }
    .docs-nav a:hover { text-decoration: underline; }
    .note { background: rgba(0, 255, 136, 0.1); border-left: 3px solid var(--accent); padding: 1rem; margin: 1rem 0; border-radius: 0 8px 8px 0; }
    .warning { background: rgba(255, 200, 0, 0.1); border-left: 3px solid #ffc800; padding: 1rem; margin: 1rem 0; border-radius: 0 8px 8px 0; }
  </style>
</head>
<body>

<!-- ── Nav ──────────────────────────────────────────────── -->
<nav>
  <div class="container">
    <a href="/" class="nav-brand">
      <img src="img/icon.svg" alt="Agent Constitution">
      Agent Constitution
    </a>
    <div class="hamburger" onclick="this.classList.toggle('open');document.querySelector('.nav-links').classList.toggle('open')">
      <span></span><span></span><span></span>
    </div>
    <div class="nav-links">
      <a href="/#how-it-works">How It Works</a>
      <a href="/#rules">Rules</a>
      <a href="/#features">Features</a>
      <a href="/docs.html" class="active">Docs</a>
      <a href="/security.html">Security</a>
      <a href="https://github.com/arunrlverma/relay4agents" target="_blank">GitHub</a>
      <a href="/#download" class="nav-cta">Download</a>
    </div>
  </div>
</nav>

<section class="hero" style="padding: 4rem 0 2rem;">
  <div class="container">
    <h1>Documentation</h1>
    <p>Everything you need to integrate Agent Constitution with your AI agent.</p>
  </div>
</section>

<div class="docs-content">
  <div class="docs-nav">
    <a href="#installation">Installation</a>
    <a href="#pairing">Pairing</a>
    <a href="#constitution">Constitution Checks</a>
    <a href="#vault">Vault</a>
    <a href="#health">Health Data</a>
    <a href="#drift">Drift Testing</a>
    <a href="#encryption">E2E Encryption</a>
    <a href="#integrity">File Integrity</a>
    <a href="#api">API Reference</a>
  </div>

  <h2 id="installation">Installation</h2>
  
  <p>Agent Constitution is distributed as a <strong>skill package</strong> that integrates with any AI agent framework. The skill includes bash scripts, configuration files, and documentation.</p>

  <h3>Using ClawdHub (Recommended)</h3>
  <pre><code>clawdhub install constitution</code></pre>
  
  <p>This installs the skill to your agent's skills directory and sets up the required configuration.</p>

  <h3>Manual Installation</h3>
  <pre><code># Clone the relay repository
git clone https://github.com/arunrlverma/relay4agents.git

# Copy the skill to your workspace
cp -r relay4agents/skill ./skills/agent-constitution

# Run setup
bash ./skills/agent-constitution/scripts/setup.sh</code></pre>

  <h3>What Gets Installed</h3>
  <table>
    <tr><th>File</th><th>Purpose</th></tr>
    <tr><td><code>SKILL.md</code></td><td>Main documentation for the agent to read</td></tr>
    <tr><td><code>active-rules.json</code></td><td>Synced rules from your iPhone</td></tr>
    <tr><td><code>scripts/*.sh</code></td><td>Bash scripts for all operations</td></tr>
    <tr><td><code>templates/</code></td><td>Rule templates and examples</td></tr>
  </table>

  <h2 id="pairing">Pairing Your iPhone</h2>

  <p>After installing the app on your iPhone, you'll get a pairing code like <code>CLAW-A1B2C3D4</code>.</p>

  <pre><code># Pair with your iPhone
bash skills/agent-constitution/scripts/pair.sh CLAW-A1B2C3D4</code></pre>

  <p>This creates <code>~/.secrets/relay4agents.env</code> with your credentials:</p>
  <pre><code>RELAY_URL=https://clawd-relay.fly.dev
CHANNEL_ID=your-channel-id
CHANNEL_TOKEN=your-secret-token</code></pre>

  <div class="note">
    <strong>Fast-Sync Mode:</strong> After pairing, the agent automatically enters fast-sync mode (2-minute heartbeat) for 24 hours to quickly sync rules and health data. This reverts to 30-minute intervals after setup.
  </div>

  <h2 id="constitution">Constitution Checks</h2>

  <p>Before performing any restricted action, your agent must check the constitution and wait for approval.</p>

  <h3>When to Check</h3>
  <ul>
    <li><strong>Communication:</strong> Emails, Slack, LinkedIn, iMessages/SMS</li>
    <li><strong>Financial:</strong> Purchases, sharing payment info</li>
    <li><strong>Social:</strong> Social media posts, public comments</li>
    <li><strong>Smart Home:</strong> Thermostat, locks, devices</li>
    <li><strong>Development:</strong> Push to main, deploy to production</li>
    <li><strong>Data:</strong> Share files externally, delete files permanently</li>
  </ul>

  <h3>Using the Script</h3>
  <pre><code>bash skills/agent-constitution/scripts/check-constitution.sh \
  --rule "Ask before sending work emails" \
  --action "Send email to team@company.com about project update" \
  --reason "User asked me to send the weekly status update"</code></pre>

  <h3>Exit Codes</h3>
  <table>
    <tr><th>Code</th><th>Meaning</th><th>Action</th></tr>
    <tr><td><code>0</code></td><td>Approved</td><td>Proceed with the action</td></tr>
    <tr><td><code>1</code></td><td>Denied or timeout</td><td>Do NOT proceed, inform user</td></tr>
  </table>

  <div class="warning">
    <strong>Important:</strong> Prior verbal permission does NOT override the constitution. Always check, even if the user says "you have my permission."
  </div>

  <h2 id="vault">Secure Vault</h2>

  <p>The vault lets your agent request sensitive data without it being typed in chat or stored in logs.</p>

  <h3>Vault Types</h3>
  <table>
    <tr><th>Type</th><th>Description</th><th>Fields</th></tr>
    <tr><td><code>identity</code></td><td>Personal info</td><td>Name, email, phone, address, DOB</td></tr>
    <tr><td><code>payment</code></td><td>Credit/debit cards</td><td>Card number, expiry, CVV, billing ZIP</td></tr>
    <tr><td><code>ssn</code></td><td>Social Security Number</td><td>9-digit SSN</td></tr>
    <tr><td><code>bank_account</code></td><td>Bank details</td><td>Routing number, account number</td></tr>
    <tr><td><code>otp</code></td><td>2FA/verification codes</td><td>One-time code</td></tr>
    <tr><td><code>custom</code></td><td>Any key-value data</td><td>User-defined fields</td></tr>
  </table>

  <h3>Requesting Vault Data</h3>
  <pre><code># Request identity for shipping form
bash skills/agent-constitution/scripts/request-vault.sh identity "Fill out shipping address"

# Request payment for checkout
bash skills/agent-constitution/scripts/request-vault.sh payment "Complete purchase on Amazon"

# Request 2FA code
bash skills/agent-constitution/scripts/request-vault.sh otp "Enter verification code for login"</code></pre>

  <h3>How It Works</h3>
  <ol>
    <li>Agent calls <code>request-vault.sh</code> with type and reason</li>
    <li>User gets push notification on iPhone</li>
    <li>User selects data (or adds new) and approves with Face ID</li>
    <li>Data is returned to agent, encrypted end-to-end</li>
    <li>Data written to temp file, agent reads and deletes immediately</li>
    <li>60-second TTL — data auto-expires</li>
  </ol>

  <div class="note">
    <strong>End-to-End Encryption:</strong> Vault data is encrypted on your iPhone before transmission. The relay never sees plaintext — only your agent can decrypt.
  </div>

  <h2 id="health">Health Data Sync</h2>

  <p>Optionally sync Apple Health metrics to your agent for health-aware assistance.</p>

  <h3>Available Metrics</h3>
  <ul>
    <li>Weight, body fat percentage, BMI</li>
    <li>Resting heart rate, HRV, walking heart rate</li>
    <li>Sleep hours (deep, REM, awake breakdown)</li>
    <li>Steps, walking/running distance, flights climbed</li>
    <li>VO2 max, active calories, exercise minutes</li>
    <li>Blood pressure (systolic/diastolic)</li>
    <li>Workout history (type, duration, calories)</li>
  </ul>

  <h3>Syncing Health Data</h3>
  <pre><code># Pull new data from relay and regenerate dashboard
bash skills/agent-constitution/scripts/sync-health.sh

# Read latest metrics (no network)
bash skills/agent-constitution/scripts/fetch-health.sh latest

# Get 14-day history
bash skills/agent-constitution/scripts/fetch-health.sh history</code></pre>

  <h3>Data Storage</h3>
  <p>Health data is stored locally in your workspace:</p>
  <ul>
    <li><code>personal/health-history/YYYY-MM-DD.json</code> — Daily snapshots</li>
    <li><code>personal/health.md</code> — Auto-generated dashboard</li>
  </ul>

  <h2 id="drift">Drift Testing</h2>

  <p>AI agents drift over time. Drift testing automatically verifies your agent still follows the rules.</p>

  <h3>How It Works</h3>
  <ol>
    <li>The app generates realistic test prompts (probes)</li>
    <li>Probes are sent to your agent through the relay</li>
    <li>Agent responds naturally (doesn't know it's being tested)</li>
    <li>Responses are evaluated for rule compliance</li>
    <li>Results show per-rule scores and drift types</li>
  </ol>

  <h3>Drift Types</h3>
  <table>
    <tr><th>Type</th><th>Description</th></tr>
    <tr><td><strong>Amnesia</strong></td><td>Agent forgot the rule exists entirely</td></tr>
    <tr><td><strong>Interpretation</strong></td><td>Followed the letter but not the spirit</td></tr>
    <tr><td><strong>Pressure</strong></td><td>Caved to social pressure or urgency</td></tr>
    <tr><td><strong>Capability</strong></td><td>Bypassed due to technical framing</td></tr>
  </table>

  <h3>Running Drift Tests</h3>
  <pre><code># Check for pending probes and run tests
bash skills/agent-constitution/scripts/run-drift-test.sh

# Force re-run even if already completed
bash skills/agent-constitution/scripts/run-drift-test.sh --force</code></pre>

  <h2 id="encryption">End-to-End Encryption</h2>

  <p>Agent Constitution uses AES-256-GCM encryption to protect sensitive data. The relay server never sees plaintext — it only passes encrypted payloads between your iPhone and your agent.</p>

  <h3>What's Encrypted</h3>
  <ul>
    <li><strong>Vault data</strong> — Payment info, identity, SSN, bank accounts, OTP codes</li>
    <li><strong>Health data</strong> — Apple Health metrics synced to your agent</li>
    <li><strong>Constitution checks</strong> — Action descriptions and approval decisions</li>
  </ul>

  <h3>How It Works</h3>
  <ul>
    <li><strong>Algorithm:</strong> AES-256-GCM (authenticated encryption)</li>
    <li><strong>Key derivation:</strong> HKDF-SHA256 from shared master secret</li>
    <li><strong>Directional keys:</strong> Separate keys for App→Agent and Agent→App</li>
    <li><strong>Nonces:</strong> Random 12-byte nonce per message</li>
    <li><strong>Auth tags:</strong> 16-byte GCM tag for integrity verification</li>
  </ul>

  <h3>Key Exchange</h3>
  <p>Encryption keys are established during device pairing. When you pair your iPhone with an agent, the relay generates a 256-bit master key and returns it to both sides. This key is stored in the iOS Keychain and in your agent's secrets file.</p>

  <pre><code># After pairing, your secrets file includes:
ENCRYPTION_KEY=base64-encoded-256-bit-key
ENCRYPTION_VERSION=1</code></pre>

  <div class="note">
    <strong>Zero-Knowledge Relay:</strong> The relay sees only encrypted payloads. Even if the relay were compromised, attackers cannot read your vault data, health metrics, or constitution checks.
  </div>

  <h2 id="integrity">File Integrity Protection</h2>

  <p>Agent Constitution monitors critical files on your agent for tampering. If your agent modifies its own rules or scripts, the app detects it immediately.</p>

  <h3>How It Works</h3>
  <ol>
    <li>On each heartbeat, the agent generates a manifest of protected file hashes</li>
    <li>The manifest is signed with HMAC-SHA256 using an HKDF-derived key</li>
    <li>The signed manifest is pushed to your iPhone through the relay</li>
    <li>The app compares hashes against known-good values</li>
    <li>If any file changed, you get a tamper alert with details</li>
  </ol>

  <h3>Protected Files</h3>
  <p>The following files are monitored for tampering:</p>
  <ul>
    <li><code>AGENTS.md</code> — Agent instructions</li>
    <li><code>active-rules.json</code> — Constitution rules</li>
    <li><code>check-constitution.sh</code> — Approval request script</li>
    <li><code>request-vault.sh</code> — Vault request script</li>
    <li><code>pair.sh</code>, <code>pull-rules.sh</code>, <code>relay-pull.sh</code> — Core scripts</li>
    <li><code>crypto_helper.py</code>, <code>crypto_utils.sh</code> — Encryption utilities</li>
    <li><code>encrypt_message.sh</code>, <code>decrypt_message.sh</code> — E2E encryption</li>
    <li><code>generate-tamper-manifest.sh</code> — Self-referential protection</li>
    <li><code>heartbeat-sync.sh</code> — Heartbeat handler</li>
  </ul>

  <h3>Tamper Manifest Format</h3>
  <pre><code>{
  "manifest_hash": "sha256-of-all-files",
  "signature": "hmac-sha256-signature",
  "generated_at": "2026-02-04T20:00:00Z",
  "file_count": 13,
  "files": {
    "AGENTS.md": {"sha256": "abc123...", "size": 10240},
    "active-rules.json": {"sha256": "def456...", "size": 1024}
  }
}</code></pre>

  <div class="warning">
    <strong>Important:</strong> The tamper manifest generator is itself protected. If an agent modifies it to exclude files, the hash of the generator script changes, triggering an alert.
  </div>

  <h2 id="api">API Reference</h2>

  <p>All communication goes through the relay server via standard HTTP.</p>

  <h3>Base URL</h3>
  <pre><code>https://clawd-relay.fly.dev</code></pre>

  <h3>Authentication</h3>
  <p>All requests require a Bearer token in the Authorization header:</p>
  <pre><code>Authorization: Bearer YOUR_CHANNEL_TOKEN</code></pre>

  <h3>Endpoints</h3>

  <h4>Push Message</h4>
  <pre><code>POST /channel/{channelId}/push?role=gateway
Content-Type: application/json

{
  "type": "constitution_check",
  "requestId": "unique-id",
  "ruleTitle": "Ask before sending work emails",
  "actionDescription": "Send email to team@company.com",
  "reason": "User requested weekly update"
}</code></pre>

  <h4>Pull Messages</h4>
  <pre><code>GET /channel/{channelId}/pull?role=gateway&wait=30</code></pre>
  <p>Long-polls for up to 30 seconds. Returns messages or empty array.</p>

  <h4>Message Types</h4>
  <table>
    <tr><th>Type</th><th>Direction</th><th>Description</th></tr>
    <tr><td><code>constitution_check</code></td><td>Agent → App</td><td>Request approval for action</td></tr>
    <tr><td><code>constitution_response</code></td><td>App → Agent</td><td>Approval decision</td></tr>
    <tr><td><code>vault_request</code></td><td>Agent → App</td><td>Request sensitive data</td></tr>
    <tr><td><code>vault_response</code></td><td>App → Agent</td><td>Encrypted vault data</td></tr>
    <tr><td><code>health_sync</code></td><td>App → Agent</td><td>HealthKit metrics</td></tr>
    <tr><td><code>rules_sync</code></td><td>App → Agent</td><td>Updated constitution rules</td></tr>
    <tr><td><code>drift_probe</code></td><td>App → Agent</td><td>Drift test prompt</td></tr>
    <tr><td><code>drift_result</code></td><td>Agent → App</td><td>Drift test response</td></tr>
  </table>

  <h3>Self-Hosting</h3>
  <p>The relay server is open source. Deploy your own instance:</p>
  <pre><code>git clone https://github.com/arunrlverma/relay4agents.git
cd relay4agents/relay
fly launch</code></pre>

</div>

<!-- ── Footer ──────────────────────────────────────────── -->
<footer>
  <div class="container">
    <span class="footer-copy">© 2026 Arun Verma. All rights reserved.</span>
    <div class="footer-links">
      <a href="/privacy.html">Privacy Policy</a>
      <a href="/terms.html">Terms of Service</a>
      <a href="/support.html">Support</a>
      <a href="/security.html">Security</a>
      <a href="https://github.com/arunrlverma/relay4agents" target="_blank">GitHub</a>
    </div>
  </div>
</footer>

<script>
document.querySelectorAll('.nav-links a').forEach(a => {
  a.addEventListener('click', () => {
    document.querySelector('.hamburger').classList.remove('open');
    document.querySelector('.nav-links').classList.remove('open');
  });
});
</script>
</body>
</html>
